---
// src/components/Timestamp.astro
import { currentTime } from "../stores/birdTimeStore";
import { formatDate, getCurrentSeasonAndTime } from "../utils/timeUtils";
import { TIME_ZONE } from "../config";

const { time } = getCurrentSeasonAndTime();
console.log("Server-side time:", time); // Debug log
const initialTime = time;
const initialDate = formatDate(
  new Date().toLocaleString("en-US", { timeZone: TIME_ZONE })
);
---

<div id="timestamp">
  <p>
    <span id="time">{initialTime}</span> âˆ™ <span id="date">{initialDate}</span>
  </p>
</div>

<script>
  import { currentTime } from "../stores/birdTimeStore";
  import { formatDate } from "../utils/timeUtils";
  import { TIME_ZONE } from "../config";

  function updateTimestamp() {
    const currentTimeValue = currentTime.get();
    console.log("Client-side current time:", currentTimeValue); // Debug log

    const timeElement = document.getElementById("time");
    const dateElement = document.getElementById("date");

    if (timeElement) {
      timeElement.textContent = currentTimeValue;
    }

    if (dateElement) {
      dateElement.textContent = formatDate(
        new Date().toLocaleString("en-US", { timeZone: TIME_ZONE })
      );
    }
  }

  currentTime.subscribe(updateTimestamp);

  // Initial update
  updateTimestamp();
</script>
