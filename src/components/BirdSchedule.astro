---
// src/components/BirdSchedule.astro
import { daySchedule, currentTime, currentBird } from "../stores/birdTimeStore";

const schedule = Object.values(daySchedule.get());
const time = currentTime.get();
const current = currentBird.get();
---

<div class="bird-schedule">
  <h2>Today's Schedule</h2>
  <ul id="schedule-list">
    {
      schedule.map((bird) => (
        <li class={bird.slug === current?.slug ? "current" : ""}>
          <a href={`/birds/${bird.slug}`}>
            {bird.startTime} - {bird.name}
          </a>
        </li>
      ))
    }
  </ul>
</div>

<script>
  import {
    daySchedule,
    currentTime,
    currentBird,
  } from "../stores/birdTimeStore";

  function updateSchedule() {
    const scheduleList = document.getElementById("schedule-list");
    if (!scheduleList) return;

    const schedule = Object.values(daySchedule.get());
    const current = currentBird.get();

    scheduleList.innerHTML = schedule
      .map(
        (bird) => `
      <li class="${bird.slug === current?.slug ? "current" : ""}">
        <a href="/birds/${bird.slug}">
          ${bird.startTime} - ${bird.name}
        </a>
      </li>
    `
      )
      .join("");
  }

  daySchedule.subscribe(updateSchedule);
  currentBird.subscribe(updateSchedule);
</script>
